<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>灯具产品展示系统</title>
  <!-- 引入Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- 引入Font Awesome -->
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <!-- Tailwind配置 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#2563eb',
            secondary: '#4f46e5',
            accent: '#0ea5e9',
            dark: '#1e293b',
            light: '#f8fafc'
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  
  <!-- 自定义工具类 -->
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .card-shadow {
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      }
      .transition-smooth {
        transition: all 0.3s ease;
      }
      .loading-spinner {
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">
  <!-- 通知提示组件 -->
  <div id="notification" class="fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg transform translate-x-full transition-smooth z-50 flex items-center gap-3 max-w-sm"></div>

  <!-- 加载状态遮罩 -->
  <div id="loadingMask" class="fixed inset-0 z-40 flex items-center justify-center bg-black bg-opacity-20 hidden">
    <div class="bg-white p-6 rounded-xl flex items-center gap-3">
      <i class="fa fa-circle-o-notch loading-spinner text-primary text-2xl"></i>
      <span class="text-dark font-medium">处理中...</span>
    </div>
  </div>

  <!-- 登录模态框 -->
  <div id="loginModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 hidden" role="dialog" aria-modal="true" aria-labelledby="loginTitle">
    <div class="bg-white rounded-xl p-8 w-full max-w-md card-shadow transform transition-all" role="document">
      <h2 id="loginTitle" class="text-[clamp(1.5rem,3vw,2rem)] font-bold text-dark mb-6 text-center">系统登录</h2>
      <div class="space-y-4">
        <div>
          <label for="username" class="block text-sm font-medium text-gray-700 mb-1">用户名</label>
          <div class="relative">
            <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-400">
              <i class="fa fa-user"></i>
            </span>
            <input type="text" id="username" class="w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-smooth" 
                   placeholder="请输入用户名" required aria-required="true">
            <div class="hidden text-red-500 text-sm mt-1 username-error">请输入用户名</div>
          </div>
        </div>
        <div>
          <label for="password" class="block text-sm font-medium text-gray-700 mb-1">密码</label>
          <div class="relative">
            <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-400">
              <i class="fa fa-lock"></i>
            </span>
            <input type="password" id="password" class="w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-smooth" 
                   placeholder="请输入密码" required aria-required="true">
            <div class="hidden text-red-500 text-sm mt-1 password-error">请输入密码</div>
          </div>
        </div>
        <div id="loginError" class="hidden text-red-500 text-sm font-medium"></div>
        <div class="flex gap-3">
          <button id="loginBtn" class="flex-1 bg-primary hover:bg-primary/90 text-white font-medium py-2 px-4 rounded-lg transition-smooth flex items-center justify-center gap-2"
                  aria-label="登录系统">
            <i class="fa fa-sign-in"></i>
            <span>登录</span>
          </button>
          <button id="cancelLoginBtn" class="flex-1 border border-gray-300 hover:bg-gray-50 text-gray-700 font-medium py-2 px-4 rounded-lg transition-smooth flex items-center justify-center gap-2"
                  aria-label="取消登录">
            <i class="fa fa-times"></i>
            <span>取消</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- 页面容器 -->
  <div class="container mx-auto px-4 py-6">
    <!-- 头部 -->
    <header class="bg-white rounded-xl shadow-md p-6 mb-6">
      <div class="flex flex-col md:flex-row justify-between items-center">
        <div class="flex items-center mb-4 md:mb-0">
          <div class="w-12 h-12 rounded-full bg-gradient-to-r from-primary to-secondary flex items-center justify-center text-white mr-4">
            <i class="fa fa-lightbulb-o text-2xl"></i>
          </div>
          <h1 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-dark">灯具产品展示系统</h1>
        </div>
        <div class="flex items-center space-x-4">
          <!-- 语言切换 -->
          <div class="flex bg-gray-100 rounded-lg p-1" id="languageSwitcher">
            <button class="lang-btn px-3 py-1 rounded-md active bg-white text-dark" data-lang="zh">中文</button>
            <button class="lang-btn px-3 py-1 rounded-md text-gray-600 hover:text-dark" data-lang="en">English</button>
          </div>
          
          <span id="userInfo" class="hidden text-gray-600 font-medium">欢迎，<span id="currentUser"></span></span>
          <button id="loginTrigger" class="px-4 py-2 bg-primary hover:bg-primary/90 text-white font-medium rounded-lg transition-smooth flex items-center gap-2"
                  aria-label="打开登录窗口">
            <i class="fa fa-sign-in"></i>
            <span>登录</span>
          </button>
          <button id="logoutBtn" class="hidden px-4 py-2 rounded-lg bg-red-100 hover:bg-red-200 text-red-600 transition-smooth flex items-center gap-2"
                  aria-label="退出登录">
            <i class="fa fa-sign-out"></i>
            <span>退出登录</span>
          </button>
        </div>
      </div>
    </header>

    <!-- 模式切换 -->
    <div class="mb-6">
      <div class="bg-white rounded-xl shadow-md p-4">
        <div class="flex flex-wrap gap-2">
          <button class="mode-btn active px-4 py-2 rounded-lg bg-primary text-white font-medium transition-smooth" 
                  data-mode="frontend" aria-pressed="true">前台展示</button>
          <button class="mode-btn px-4 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-700 transition-smooth" 
                  data-mode="backend" aria-pressed="false">后台管理</button>
        </div>
      </div>
    </div>

    <!-- 前台展示内容 -->
    <div id="frontendContent" class="space-y-6">
      <!-- 搜索栏 -->
      <div class="bg-white rounded-xl shadow-md p-6">
        <div class="flex flex-col md:flex-row gap-4">
          <div class="relative flex-1">
            <input type="text" id="searchInput" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-smooth" 
                   placeholder="搜索产品名称或描述..." aria-label="搜索产品">
            <i class="fa fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
          </div>
          <div class="flex gap-3">
            <select id="categoryFilter" class="px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-smooth bg-white"
                    aria-label="产品类别筛选">
              <option value="all">所有类别</option>
            </select>
            <button id="searchBtn" class="px-6 py-3 bg-primary hover:bg-primary/90 text-white font-medium rounded-lg transition-smooth flex items-center gap-2"
                    aria-label="执行搜索">
              <i class="fa fa-search"></i>
              <span>搜索</span>
            </button>
          </div>
        </div>
      </div>

      <!-- 产品大类 -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6" id="categoriesGrid">
        <!-- 大类卡片将通过JS动态生成 -->
      </div>

      <!-- 产品展示区 -->
      <div class="bg-white rounded-xl shadow-md p-6">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-bold text-dark">产品列表</h2>
          <div class="flex gap-2" role="group" aria-label="视图切换">
            <button id="gridViewBtn" class="p-2 bg-primary/10 text-primary rounded-lg transition-smooth active"
                    aria-label="网格视图" aria-pressed="true">
              <i class="fa fa-th-large"></i>
            </button>
            <button id="listViewBtn" class="p-2 hover:bg-gray-100 text-gray-700 rounded-lg transition-smooth"
                    aria-label="列表视图" aria-pressed="false">
              <i class="fa fa-list"></i>
            </button>
          </div>
        </div>
        
        <!-- 分页控件 -->
        <div class="mb-6 flex justify-between items-center">
          <div class="text-gray-600 text-sm">
            显示 <span id="currentItemsCount">0</span> 条，共 <span id="totalItemsCount">0</span> 条
          </div>
          <div class="flex gap-2">
            <button id="prevPage" class="px-3 py-1 border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
                    aria-label="上一页" disabled>上一页</button>
            <span id="pageInfo" class="px-3 py-1">第 1 页</span>
            <button id="nextPage" class="px-3 py-1 border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
                    aria-label="下一页" disabled>下一页</button>
          </div>
        </div>
        
        <div id="productsGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
          <!-- 产品卡片将通过JS动态生成 -->
        </div>
        
        <!-- 无数据状态 -->
        <div id="noProducts" class="hidden py-12 text-center">
          <i class="fa fa-search text-4xl text-gray-300 mb-3"></i>
          <p class="text-gray-500">没有找到匹配的产品</p>
        </div>
      </div>
    </div>

    <!-- 后台管理内容 -->
    <div id="backendContent" class="hidden space-y-6">
      <!-- 管理选项卡 -->
      <div class="bg-white rounded-xl shadow-md p-4" role="tablist" aria-label="管理选项卡">
        <div class="flex flex-wrap items-center justify-between">
          <div class="flex flex-wrap border-b border-gray-200">
            <button class="manage-tab active py-3 px-6 font-medium text-primary border-b-2 border-primary" 
                    data-tab="categories" role="tab" aria-selected="true" aria-controls="categoriesTab">管理大类</button>
            <button class="manage-tab py-3 px-6 font-medium text-gray-600 hover:text-gray-900" 
                    data-tab="subcategories" role="tab" aria-selected="false" aria-controls="subcategoriesTab">管理小类</button>
            <button class="manage-tab py-3 px-6 font-medium text-gray-600 hover:text-gray-900" 
                    data-tab="products" role="tab" aria-selected="false" aria-controls="productsTab">管理产品</button>
          </div>
          <button id="changePasswordBtn" class="ml-auto px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium rounded-lg transition-smooth flex items-center gap-2"
                  aria-label="修改账号密码">
            <i class="fa fa-cog"></i>
            <span>修改密码</span>
          </button>
        </div>
      </div>

      <!-- 大类管理 -->
      <div id="categoriesTab" class="bg-white rounded-xl shadow-md p-6" role="tabpanel" aria-labelledby="categoriesTab">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-bold text-dark">管理产品大类</h2>
          <button id="addCategoryBtn" class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white font-medium rounded-lg transition-smooth flex items-center gap-2"
                  aria-label="添加新的产品大类">
            <i class="fa fa-plus"></i>
            <span>添加大类</span>
          </button>
        </div>
        <div class="overflow-x-auto">
          <table class="min-w-full">
            <thead>
              <tr class="bg-gray-50 border-b border-gray-200">
                <th class="py-3 px-4 text-left text-sm font-medium text-gray-600" scope="col">ID</th>
                <th class="py-3 px-4 text-left text-sm font-medium text-gray-600" scope="col">大类名称</th>
                <th class="py-3 px-4 text-left text-sm font-medium text-gray-600" scope="col">描述</th>
                <th class="py-3 px-4 text-left text-sm font-medium text-gray-600" scope="col">图片</th>
                <th class="py-3 px-4 text-left text-sm font-medium text-gray-600" scope="col">操作</th>
              </tr>
            </thead>
            <tbody id="categoriesTableBody">
              <!-- 大类数据将通过JS动态生成 -->
            </tbody>
          </table>
        </div>
        <!-- 无数据状态 -->
        <div id="noCategories" class="hidden py-12 text-center">
          <p class="text-gray-500">暂无产品大类数据，请添加</p>
        </div>
      </div>

      <!-- 小类管理 -->
      <div id="subcategoriesTab" class="hidden bg-white rounded-xl shadow-md p-6" role="tabpanel" aria-labelledby="subcategoriesTab">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-bold text-dark">管理产品小类</h2>
          <button id="addSubcategoryBtn" class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white font-medium rounded-lg transition-smooth flex items-center gap-2"
                  aria-label="添加新的产品小类">
            <i class="fa fa-plus"></i>
            <span>添加小类</span>
          </button>
        </div>
        <div class="overflow-x-auto">
          <table class="min-w-full">
            <thead>
              <tr class="bg-gray-50 border-b border-gray-200">
                <th class="py-3 px-4 text-left text-sm font-medium text-gray-600" scope="col">ID</th>
                <th class="py-3 px-4 text-left text-sm font-medium text-gray-600" scope="col">所属大类</th>
                <th class="py-3 px-4 text-left text-sm font-medium text-gray-600" scope="col">小类名称</th>
                <th class="py-3 px-4 text-left text-sm font-medium text-gray-600" scope="col">描述</th>
                <th class="py-3 px-4 text-left text-sm font-medium text-gray-600" scope="col">操作</th>
              </tr>
            </thead>
            <tbody id="subcategoriesTableBody">
              <!-- 小类数据将通过JS动态生成 -->
            </tbody>
          </table>
        </div>
        <!-- 无数据状态 -->
        <div id="noSubcategories" class="hidden py-12 text-center">
          <p class="text-gray-500">暂无产品小类数据，请添加</p>
        </div>
      </div>

      <!-- 产品管理 -->
      <div id="productsTab" class="hidden bg-white rounded-xl shadow-md p-6" role="tabpanel" aria-labelledby="productsTab">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-bold text-dark">管理产品</h2>
          <button id="addProductBtn" class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white font-medium rounded-lg transition-smooth flex items-center gap-2"
                  aria-label="添加新产品">
            <i class="fa fa-plus"></i>
            <span>添加产品</span>
          </button>
        </div>
        <div class="overflow-x-auto">
          <table class="min-w-full">
            <thead>
              <tr class="bg-gray-50 border-b border-gray-200">
                <th class="py-3 px-4 text-left text-sm font-medium text-gray-600" scope="col">ID</th>
                <th class="py-3 px-4 text-left text-sm font-medium text-gray-600" scope="col">产品名称</th>
                <th class="py-3 px-4 text-left text-sm font-medium text-gray-600" scope="col">所属小类</th>
                <th class="py-3 px-4 text-left text-sm font-medium text-gray-600" scope="col">价格</th>
                <th class="py-3 px-4 text-left text-sm font-medium text-gray-600" scope="col">描述</th>
                <th class="py-3 px-4 text-left text-sm font-medium text-gray-600" scope="col">图片</th>
                <th class="py-3 px-4 text-left text-sm font-medium text-gray-600" scope="col">操作</th>
              </tr>
            </thead>
            <tbody id="productsTableBody">
              <!-- 产品数据将通过JS动态生成 -->
            </tbody>
          </table>
        </div>
        <!-- 无数据状态 -->
        <div id="noProductsAdmin" class="hidden py-12 text-center">
          <p class="text-gray-500">暂无产品数据，请添加</p>
        </div>
      </div>
    </div>
  </div>

  <!-- 添加/编辑大类模态框 -->
  <div id="categoryModal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50" role="dialog" aria-modal="true" aria-labelledby="categoryModalTitle">
    <div class="bg-white rounded-xl p-6 w-full max-w-lg card-shadow" role="document">
      <h3 id="categoryModalTitle" class="text-xl font-bold text-dark mb-4">添加大类</h3>
      <form id="categoryForm">
        <input type="hidden" id="categoryId">
        <div class="space-y-4">
          <div>
            <label for="categoryName" class="block text-sm font-medium text-gray-700 mb-1">大类名称</label>
            <input type="text" id="categoryName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-smooth" 
                   required aria-required="true">
            <div class="hidden text-red-500 text-sm mt-1 category-name-error">请输入大类名称</div>
          </div>
          <div>
            <label for="categoryDesc" class="block text-sm font-medium text-gray-700 mb-1">描述</label>
            <textarea id="categoryDesc" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-smooth" 
                      rows="3"></textarea>
          </div>
          <div>
            <label for="categoryImage" class="block text-sm font-medium text-gray-700 mb-1">上传图片</label>
            <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-lg">
              <div class="space-y-1 text-center">
                <i class="fa fa-cloud-upload text-3xl text-gray-400"></i>
                <div class="flex text-sm text-gray-600">
                  <label for="categoryImage" class="relative cursor-pointer bg-white rounded-md font-medium text-primary hover:text-primary/90">
                    <span>上传图片</span>
                    <input id="categoryImage" name="categoryImage" type="file" accept="image/*" class="sr-only">
                  </label>
                  <p class="pl-1">或拖放</p>
                </div>
                <p class="text-xs text-gray-500">PNG, JPG 或 GIF（最大 10MB）</p>
              </div>
            </div>
            <img id="categoryImagePreview" class="hidden mt-3 max-w-full h-auto rounded-lg" src="" alt="预览图">
            <input type="hidden" id="categoryImageData">
          </div>
        </div>
        <div class="mt-6 flex justify-end space-x-3">
          <button type="button" id="cancelCategoryBtn" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-smooth"
                  aria-label="取消添加大类">取消</button>
          <button type="submit" class="px-4 py-2 bg-primary hover:bg-primary/90 text-white font-medium rounded-lg transition-smooth"
                  aria-label="保存大类信息">保存</button>
        </div>
      </form>
    </div>
  </div>

  <!-- 添加/编辑小类模态框 -->
  <div id="subcategoryModal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50" role="dialog" aria-modal="true" aria-labelledby="subcategoryModalTitle">
    <div class="bg-white rounded-xl p-6 w-full max-w-lg card-shadow" role="document">
      <h3 id="subcategoryModalTitle" class="text-xl font-bold text-dark mb-4">添加小类</h3>
      <form id="subcategoryForm">
        <input type="hidden" id="subcategoryId">
        <div class="space-y-4">
          <div>
            <label for="parentCategory" class="block text-sm font-medium text-gray-700 mb-1">所属大类</label>
            <select id="parentCategory" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-smooth" 
                    required aria-required="true">
              <!-- 大类选项将通过JS动态生成 -->
              <option value="">请选择大类</option>
            </select>
            <div class="hidden text-red-500 text-sm mt-1 parent-category-error">请选择所属大类</div>
          </div>
          <div>
            <label for="subcategoryName" class="block text-sm font-medium text-gray-700 mb-1">小类名称</label>
            <input type="text" id="subcategoryName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-smooth" 
                   required aria-required="true">
            <div class="hidden text-red-500 text-sm mt-1 subcategory-name-error">请输入小类名称</div>
          </div>
          <div>
            <label for="subcategoryDesc" class="block text-sm font-medium text-gray-700 mb-1">描述</label>
            <textarea id="subcategoryDesc" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-smooth" 
                      rows="3"></textarea>
          </div>
        </div>
        <div class="mt-6 flex justify-end space-x-3">
          <button type="button" id="cancelSubcategoryBtn" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-smooth"
                  aria-label="取消添加小类">取消</button>
          <button type="submit" class="px-4 py-2 bg-primary hover:bg-primary/90 text-white font-medium rounded-lg transition-smooth"
                  aria-label="保存小类信息">保存</button>
        </div>
      </form>
    </div>
  </div>

  <!-- 添加/编辑产品模态框 -->
  <div id="productModal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50" role="dialog" aria-modal="true" aria-labelledby="productModalTitle">
    <div class="bg-white rounded-xl p-6 w-full max-w-2xl card-shadow max-h-[90vh] overflow-y-auto" role="document">
      <h3 id="productModalTitle" class="text-xl font-bold text-dark mb-4">添加产品</h3>
      <form id="productForm">
        <input type="hidden" id="productId">
        <div class="space-y-4">
          <div>
            <label for="productName" class="block text-sm font-medium text-gray-700 mb-1">产品名称</label>
            <input type="text" id="productName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-smooth" 
                   required aria-required="true">
            <div class="hidden text-red-500 text-sm mt-1 product-name-error">请输入产品名称</div>
          </div>
          <div>
            <label for="parentSubcategory" class="block text-sm font-medium text-gray-700 mb-1">所属小类</label>
            <select id="parentSubcategory" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-smooth" 
                    required aria-required="true">
              <!-- 小类选项将通过JS动态生成 -->
              <option value="">请选择小类</option>
            </select>
            <div class="hidden text-red-500 text-sm mt-1 parent-subcategory-error">请选择所属小类</div>
          </div>
          <div>
            <label for="productPrice" class="block text-sm font-medium text-gray-700 mb-1">价格</label>
            <input type="number" id="productPrice" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-smooth" 
                   min="0" step="0.01" required aria-required="true">
            <div class="hidden text-red-500 text-sm mt-1 product-price-error">请输入有效的价格</div>
          </div>
          <div>
            <label for="productAttributes" class="block text-sm font-medium text-gray-700 mb-1">产品属性</label>
            <div id="productAttributes" class="space-y-3">
              <!-- 属性项将通过JS动态生成 -->
              <div class="attribute-item flex gap-2 items-center">
                <select class="attribute-type px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-smooth">
                  <option value="size">尺寸</option>
                  <option value="color">颜色</option>
                  <option value="power">功率</option>
                  <option value="custom">自定义</option>
                </select>
                <input type="text" class="attribute-name hidden px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-smooth" placeholder="属性名称">
                <input type="text" class="attribute-value flex-grow px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-smooth" placeholder="属性值">
                <button type="button" class="delete-attribute px-3 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-smooth" aria-label="删除属性">
                  <i class="fa fa-times"></i>
                </button>
              </div>
              <div class="attribute-item flex gap-2 items-center">
                <select class="attribute-type px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-smooth">
                  <option value="size">尺寸</option>
                  <option value="color">颜色</option>
                  <option value="power">功率</option>
                  <option value="custom">自定义</option>
                </select>
                <input type="text" class="attribute-name hidden px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-smooth" placeholder="属性名称">
                <input type="text" class="attribute-value flex-grow px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-smooth" placeholder="属性值">
                <button type="button" class="delete-attribute px-3 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-smooth" aria-label="删除属性">
                  <i class="fa fa-times"></i>
                </button>
              </div>
            </div>
            <button type="button" id="addAttributeBtn" class="mt-3 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-smooth flex items-center">
              <i class="fa fa-plus mr-2"></i> 添加属性
            </button>
            <input type="hidden" id="productAttrs" value="[]">
          </div>
          <div>
            <label for="productImages" class="block text-sm font-medium text-gray-700 mb-1">上传图片（可上传多张）</label>
            <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-lg">
              <div class="space-y-1 text-center">
                <i class="fa fa-cloud-upload text-3xl text-gray-400"></i>
                <div class="flex text-sm text-gray-600">
                  <label for="productImages" class="relative cursor-pointer bg-white rounded-md font-medium text-primary hover:text-primary/90">
                    <span>上传图片</span>
                    <input id="productImages" name="productImages" type="file" accept="image/*" multiple class="sr-only">
                  </label>
                  <p class="pl-1">或拖放</p>
                </div>
                <p class="text-xs text-gray-500">PNG, JPG 或 GIF（最大 10MB）</p>
              </div>
            </div>
            <div id="productImagesPreview" class="mt-3 grid grid-cols-4 gap-3"></div>
            <input type="hidden" id="productImagesData">
          </div>
        </div>
        <div class="mt-6 flex justify-end space-x-3">
          <button type="button" id="cancelProductBtn" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-smooth"
                  aria-label="取消添加产品">取消</button>
          <button type="submit" class="px-4 py-2 bg-primary hover:bg-primary/90 text-white font-medium rounded-lg transition-smooth"
                  aria-label="保存产品信息">保存</button>
        </div>
      </form>
    </div>
  </div>

  <!-- 修改密码模态框 -->
  <div id="changePasswordModal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50" role="dialog" aria-modal="true" aria-labelledby="changePasswordModalTitle">
    <div class="bg-white rounded-xl p-6 w-full max-w-md card-shadow" role="document">
      <h3 id="changePasswordModalTitle" class="text-xl font-bold text-dark mb-4">修改密码</h3>
      <form id="changePasswordForm">
        <div class="space-y-4">
          <div>
            <label for="currentPassword" class="block text-sm font-medium text-gray-700 mb-1">当前密码</label>
            <div class="relative">
              <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-400">
                <i class="fa fa-lock"></i>
              </span>
              <input type="password" id="currentPassword" class="w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-smooth" 
                     required aria-required="true">
              <div class="hidden text-red-500 text-sm mt-1 current-password-error">请输入当前密码</div>
            </div>
          </div>
          <div>
            <label for="newPassword" class="block text-sm font-medium text-gray-700 mb-1">新密码</label>
            <div class="relative">
              <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-400">
                <i class="fa fa-key"></i>
              </span>
              <input type="password" id="newPassword" class="w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-smooth" 
                     required aria-required="true">
              <div class="hidden text-red-500 text-sm mt-1 new-password-error">请输入新密码（至少6位）</div>
            </div>
          </div>
          <div>
            <label for="confirmPassword" class="block text-sm font-medium text-gray-700 mb-1">确认新密码</label>
            <div class="relative">
              <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-400">
                <i class="fa fa-key"></i>
              </span>
              <input type="password" id="confirmPassword" class="w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-smooth" 
                     required aria-required="true">
              <div class="hidden text-red-500 text-sm mt-1 confirm-password-error">两次输入的密码不一致</div>
            </div>
          </div>
        </div>
        <div id="changePasswordError" class="hidden text-red-500 text-sm font-medium mt-4"></div>
        <div class="mt-6 flex justify-end space-x-3">
          <button type="button" id="cancelChangePasswordBtn" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-smooth" 
                  aria-label="取消修改密码">取消</button>
          <button type="submit" class="px-4 py-2 bg-primary hover:bg-primary/90 text-white font-medium rounded-lg transition-smooth" 
                  aria-label="保存新密码">保存</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // 工具函数模块
    const utils = {
      // 显示通知
      showNotification(message, type = 'success') {
        const notification = document.getElementById('notification');
        notification.textContent = '';
        notification.className = 'fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg transform translate-x-full transition-smooth z-50 flex items-center gap-3 max-w-sm';
        
        // 设置通知类型样式
        if (type === 'success') {
          notification.classList.add('bg-green-100', 'text-green-800', 'border-l-4', 'border-green-500');
          notification.innerHTML = '<i class="fa fa-check-circle"></i><span>' + message + '</span>';
        } else if (type === 'error') {
          notification.classList.add('bg-red-100', 'text-red-800', 'border-l-4', 'border-red-500');
          notification.innerHTML = '<i class="fa fa-exclamation-circle"></i><span>' + message + '</span>';
        } else if (type === 'warning') {
          notification.classList.add('bg-yellow-100', 'text-yellow-800', 'border-l-4', 'border-yellow-500');
          notification.innerHTML = '<i class="fa fa-exclamation-triangle"></i><span>' + message + '</span>';
        }
        
        // 显示通知
        setTimeout(() => {
          notification.classList.remove('translate-x-full');
        }, 100);
        
        // 3秒后自动隐藏
        setTimeout(() => {
          notification.classList.add('translate-x-full');
        }, 3000);
      },
      
      // 显示加载状态
      showLoading() {
        document.getElementById('loadingMask').classList.remove('hidden');
      },
      
      // 隐藏加载状态
      hideLoading() {
        document.getElementById('loadingMask').classList.add('hidden');
      },
      
      // 生成唯一ID
      generateId() {
        return Date.now().toString(36) + Math.random().toString(36).substr(2, 5);
      },
      
      // 简单的密码哈希处理
      hashPassword(password) {
        // 实际项目中应使用更安全的加密方式
        return btoa(password + 'salt');
      },
      
      // 防抖函数
      debounce(func, delay = 300) {
        let timer;
        return function(...args) {
          clearTimeout(timer);
          timer = setTimeout(() => {
            func.apply(this, args);
          }, delay);
        };
      },
      
      // 验证输入是否为空
      validateRequired(input, errorElement) {
        if (!input.value.trim()) {
          errorElement.classList.remove('hidden');
          return false;
        }
        errorElement.classList.add('hidden');
        return true;
      },
      
      // 使用DocumentFragment优化DOM操作
      createFragment(html) {
        const fragment = document.createDocumentFragment();
        const temp = document.createElement('div');
        temp.innerHTML = html;
        while (temp.firstChild) {
          fragment.appendChild(temp.firstChild);
        }
        return fragment;
      }
    };

    // 数据管理模块
    const dataManager = {
      // 初始化数据
      init() {
        if (!localStorage.getItem('categories')) {
          localStorage.setItem('categories', JSON.stringify([]));
        }
        if (!localStorage.getItem('subcategories')) {
          localStorage.setItem('subcategories', JSON.stringify([]));
        }
        if (!localStorage.getItem('products')) {
          localStorage.setItem('products', JSON.stringify([]));
        }
        if (!localStorage.getItem('user')) {
          // 存储加密后的示例密码
          localStorage.setItem('user', JSON.stringify({
            username: 'admin',
            password: utils.hashPassword('admin123')
          }));
        }
      },
      
      // 获取大类数据
      getCategories() {
        return JSON.parse(localStorage.getItem('categories') || '[]');
      },
      
      // 保存大类数据
      saveCategories(categories) {
        localStorage.setItem('categories', JSON.stringify(categories));
      },
      
      // 获取小类数据
      getSubcategories() {
        return JSON.parse(localStorage.getItem('subcategories') || '[]');
      },
      
      // 保存小类数据
      saveSubcategories(subcategories) {
        localStorage.setItem('subcategories', JSON.stringify(subcategories));
      },
      
      // 获取产品数据
      getProducts() {
        return JSON.parse(localStorage.getItem('products') || '[]');
      },
      
      // 保存产品数据
      saveProducts(products) {
        localStorage.setItem('products', JSON.stringify(products));
      },
      
      // 验证用户登录
      validateUser(username, password) {
        const user = JSON.parse(localStorage.getItem('user') || '{}');
        return user.username === username && user.password === utils.hashPassword(password);
      },
      
      // 检查用户是否已登录
      isLoggedIn() {
        return localStorage.getItem('loggedInUser') !== null;
      },
      
      // 登录用户
      loginUser(username) {
        localStorage.setItem('loggedInUser', username);
      },
      
      // 登出用户
      logoutUser() {
        localStorage.removeItem('loggedInUser');
      },
      
      // 获取当前登录用户
      getCurrentUser() {
        return localStorage.getItem('loggedInUser');
      },
      
      // 修改密码
      changePassword(currentPassword, newPassword) {
        // 验证当前密码
        const user = JSON.parse(localStorage.getItem('user') || '{}');
        if (user.password !== utils.hashPassword(currentPassword)) {
          return { success: false, message: '当前密码不正确' };
        }
        
        // 更新密码
        user.password = utils.hashPassword(newPassword);
        localStorage.setItem('user', JSON.stringify(user));
        return { success: true, message: '密码修改成功' };
      }
    };

    // 视图渲染模块
    const viewRenderer = {
      // 渲染大类列表
      renderCategories() {
        const categories = dataManager.getCategories();
        const tableBody = document.getElementById('categoriesTableBody');
        const categoriesGrid = document.getElementById('categoriesGrid');
        const categoryFilter = document.getElementById('categoryFilter');
        const noCategories = document.getElementById('noCategories');
        
        // 清空现有内容
        tableBody.innerHTML = '';
        categoriesGrid.innerHTML = '';
        
        // 检查是否有数据
        if (categories.length === 0) {
          noCategories.classList.remove('hidden');
          return;
        }
        noCategories.classList.add('hidden');
        
        // 用于批量DOM操作的文档片段
        const tableFragment = document.createDocumentFragment();
        const gridFragment = document.createDocumentFragment();
        
        categories.forEach(category => {
          // 渲染表格行
          const row = document.createElement('tr');
          row.className = 'border-b border-gray-200 hover:bg-gray-50 transition-smooth';
          row.innerHTML = `
            <td class="py-4 px-4 text-sm text-gray-900">${category.id}</td>
            <td class="py-4 px-4 text-sm text-gray-900">${category.name}</td>
            <td class="py-4 px-4 text-sm text-gray-600">${category.desc || '-'}</td>
            <td class="py-4 px-4 text-sm">
              ${category.image ? `<img src="${category.image}" alt="${category.name}" class="h-12 w-auto rounded">` : '-'}
            </td>
            <td class="py-4 px-4 text-sm">
              <div class="flex gap-2">
                <button class="edit-category text-blue-600 hover:text-blue-800" data-id="${category.id}" aria-label="编辑${category.name}">
                  <i class="fa fa-pencil"></i>
                </button>
                <button class="delete-category text-red-600 hover:text-red-800" data-id="${category.id}" aria-label="删除${category.name}">
                  <i class="fa fa-trash"></i>
                </button>
              </div>
            </td>
          `;
          tableFragment.appendChild(row);
          
          // 渲染前台大类卡片
          const card = document.createElement('div');
          card.className = 'bg-white rounded-xl overflow-hidden card-shadow hover:shadow-lg transition-smooth';
          card.innerHTML = `
            <div class="h-48 overflow-hidden">
              <img src="${category.image || 'https://picsum.photos/400/300?random=' + category.id}" 
                   alt="${category.name}" 
                   class="w-full h-full object-cover transition-smooth hover:scale-105"
                   loading="lazy">
            </div>
            <div class="p-4">
              <h3 class="font-bold text-lg mb-2">${category.name}</h3>
              <p class="text-gray-600 text-sm mb-3">${category.desc || '暂无描述'}</p>
              <button class="view-category-products text-primary hover:text-primary/80 font-medium flex items-center gap-1" data-id="${category.id}">
                <span>查看产品</span>
                <i class="fa fa-arrow-right"></i>
              </button>
            </div>
          `;
          gridFragment.appendChild(card);
          
          // 添加到筛选下拉框
          const option = document.createElement('option');
          option.value = category.id;
          option.textContent = category.name;
          categoryFilter.appendChild(option);
        });
        
        // 一次性添加到DOM
        tableBody.appendChild(tableFragment);
        categoriesGrid.appendChild(gridFragment);
      },
      
      // 渲染小类列表
      renderSubcategories() {
        const subcategories = dataManager.getSubcategories();
        const categories = dataManager.getCategories();
        const tableBody = document.getElementById('subcategoriesTableBody');
        const noSubcategories = document.getElementById('noSubcategories');
        
        // 清空现有内容
        tableBody.innerHTML = '';
        
        // 检查是否有数据
        if (subcategories.length === 0) {
          noSubcategories.classList.remove('hidden');
          return;
        }
        noSubcategories.classList.add('hidden');
        
        // 创建文档片段
        const fragment = document.createDocumentFragment();
        
        subcategories.forEach(subcategory => {
          // 查找所属大类名称
          const category = categories.find(c => c.id === subcategory.parentId);
          const categoryName = category ? category.name : '未知大类';
          
          const row = document.createElement('tr');
          row.className = 'border-b border-gray-200 hover:bg-gray-50 transition-smooth';
          row.innerHTML = `
            <td class="py-4 px-4 text-sm text-gray-900">${subcategory.id}</td>
            <td class="py-4 px-4 text-sm text-gray-900">${categoryName}</td>
            <td class="py-4 px-4 text-sm text-gray-900">${subcategory.name}</td>
            <td class="py-4 px-4 text-sm text-gray-600">${subcategory.desc || '-'}</td>
            <td class="py-4 px-4 text-sm">
              <div class="flex gap-2">
                <button class="edit-subcategory text-blue-600 hover:text-blue-800" data-id="${subcategory.id}" aria-label="编辑${subcategory.name}">
                  <i class="fa fa-pencil"></i>
                </button>
                <button class="delete-subcategory text-red-600 hover:text-red-800" data-id="${subcategory.id}" aria-label="删除${subcategory.name}">
                  <i class="fa fa-trash"></i>
                </button>
              </div>
            </td>
          `;
          fragment.appendChild(row);
        });
        
        tableBody.appendChild(fragment);
      },
      
      // 渲染产品列表
      renderProducts(filter = {}) {
        let products = dataManager.getProducts();
        const subcategories = dataManager.getSubcategories();
        const categories = dataManager.getCategories();
        const tableBody = document.getElementById('productsTableBody');
        const productsGrid = document.getElementById('productsGrid');
        const noProducts = document.getElementById('noProducts');
        const noProductsAdmin = document.getElementById('noProductsAdmin');
        const currentItemsCount = document.getElementById('currentItemsCount');
        const totalItemsCount = document.getElementById('totalItemsCount');
        
        // 清空现有内容
        tableBody.innerHTML = '';
        productsGrid.innerHTML = '';
        
        // 应用筛选
        if (filter.categoryId) {
          // 找出该大类下的所有小类
          const subIds = subcategories
            .filter(sub => sub.parentId === filter.categoryId)
            .map(sub => sub.id);
          products = products.filter(p => subIds.includes(p.parentId));
        }
        
        if (filter.search) {
          const searchTerm = filter.search.toLowerCase();
          products = products.filter(p => 
            p.name.toLowerCase().includes(searchTerm) || 
            p.desc.toLowerCase().includes(searchTerm)
          );
        }
        
        // 检查是否有数据
        if (products.length === 0) {
          noProducts.classList.remove('hidden');
          noProductsAdmin.classList.remove('hidden');
          currentItemsCount.textContent = '0';
          totalItemsCount.textContent = '0';
          return;
        }
        
        noProducts.classList.add('hidden');
        noProductsAdmin.classList.add('hidden');
        currentItemsCount.textContent = products.length;
        totalItemsCount.textContent = products.length;
        
        // 创建文档片段
        const tableFragment = document.createDocumentFragment();
        const gridFragment = document.createDocumentFragment();
        
        products.forEach(product => {
          // 查找所属小类和大类名称
          const subcategory = subcategories.find(s => s.id === product.parentId);
          const category = subcategory ? categories.find(c => c.id === subcategory.parentId) : null;
          const subcategoryName = subcategory ? subcategory.name : '未知小类';
          
          // 渲染管理表格行
          const tableRow = document.createElement('tr');
          tableRow.className = 'border-b border-gray-200 hover:bg-gray-50 transition-smooth';
          tableRow.innerHTML = `
            <td class="py-4 px-4 text-sm text-gray-900">${product.id}</td>
            <td class="py-4 px-4 text-sm text-gray-900">${product.name}</td>
            <td class="py-4 px-4 text-sm text-gray-900">${subcategoryName}</td>
            <td class="py-4 px-4 text-sm text-gray-900">¥${parseFloat(product.price).toFixed(2)}</td>
            <td class="py-4 px-4 text-sm text-gray-600 max-w-xs truncate">${product.desc || '-'}</td>
            <td class="py-4 px-4 text-sm">
              ${product.images && product.images.length > 0 
                ? `<img src="${product.images[0]}" alt="${product.name}" class="h-12 w-auto rounded">` 
                : '-'}
            </td>
            <td class="py-4 px-4 text-sm">
              <div class="flex gap-2">
                <button class="edit-product text-blue-600 hover:text-blue-800" data-id="${product.id}" aria-label="编辑${product.name}">
                  <i class="fa fa-pencil"></i>
                </button>
                <button class="delete-product text-red-600 hover:text-red-800" data-id="${product.id}" aria-label="删除${product.name}">
                  <i class="fa fa-trash"></i>
                </button>
              </div>
            </td>
          `;
          tableFragment.appendChild(tableRow);
          
          // 渲染前台产品卡片
          const card = document.createElement('div');
          card.className = 'bg-white rounded-xl overflow-hidden card-shadow hover:shadow-lg transition-smooth flex flex-col';
          card.innerHTML = `
            <div class="h-48 overflow-hidden flex-shrink-0">
              <img src="${product.images && product.images.length > 0 ? product.images[0] : 'https://picsum.photos/400/300?random=' + product.id}" 
                   alt="${product.name}" 
                   class="w-full h-full object-cover transition-smooth hover:scale-105"
                   loading="lazy">
            </div>
            <div class="p-4 flex flex-col flex-grow">
              <div class="text-sm text-gray-500 mb-1">${category ? category.name : ''} / ${subcategoryName}</div>
              <h3 class="font-bold text-lg mb-2">${product.name}</h3>
              <p class="text-gray-600 text-sm mb-3 flex-grow">${product.attrs && product.attrs.length > 0 ? product.attrs.map(attr => `${attr.name}: ${attr.value}`).join(' | ') : '暂无属性'}</p>
              <div class="flex justify-between items-center mt-2">
                <!-- 价格已隐藏 -->
              </div>
            </div>
          `;
          gridFragment.appendChild(card);
        });
        
        // 一次性添加到DOM
        tableBody.appendChild(tableFragment);
        productsGrid.appendChild(gridFragment);
      },
      
      // 渲染小类下拉框选项
      renderSubcategoryOptions(selectId, selectedId = '') {
        const subcategories = dataManager.getSubcategories();
        const categories = dataManager.getCategories();
        const select = document.getElementById(selectId);
        
        // 保存当前选中值
        const currentValue = select.value;
        
        // 清空现有选项（保留第一个提示选项）
        while (select.options.length > 1) {
          select.remove(1);
        }
        
        // 按大类分组显示小类
        categories.forEach(category => {
          // 创建optgroup
          const optgroup = document.createElement('optgroup');
          optgroup.label = category.name;
          
          // 添加该大类下的所有小类
          const categorySubs = subcategories.filter(sub => sub.parentId === category.id);
          categorySubs.forEach(sub => {
            const option = document.createElement('option');
            option.value = sub.id;
            option.textContent = sub.name;
            if (sub.id === selectedId || (selectedId === '' && sub.id === currentValue)) {
              option.selected = true;
            }
            optgroup.appendChild(option);
          });
          
          if (categorySubs.length > 0) {
            select.appendChild(optgroup);
          }
        });
      },
      
      // 渲染大类下拉框选项
      renderCategoryOptions(selectId, selectedId = '') {
        const categories = dataManager.getCategories();
        const select = document.getElementById(selectId);
        
        // 保存当前选中值
        const currentValue = select.value;
        
        // 清空现有选项（保留第一个提示选项）
        while (select.options.length > 1) {
          select.remove(1);
        }
        
        categories.forEach(category => {
          const option = document.createElement('option');
          option.value = category.id;
          option.textContent = category.name;
          if (category.id === selectedId || (selectedId === '' && category.id === currentValue)) {
            option.selected = true;
          }
          select.appendChild(option);
        });
      },
      
      // 更新登录状态UI
      updateLoginStatus() {
        const isLoggedIn = dataManager.isLoggedIn();
        const loginTrigger = document.getElementById('loginTrigger');
        const logoutBtn = document.getElementById('logoutBtn');
        const userInfo = document.getElementById('userInfo');
        const currentUser = document.getElementById('currentUser');
        const backendContent = document.getElementById('backendContent');
        const modeBtns = document.querySelectorAll('.mode-btn');
        
        if (isLoggedIn) {
          loginTrigger.classList.add('hidden');
          logoutBtn.classList.remove('hidden');
          userInfo.classList.remove('hidden');
          currentUser.textContent = dataManager.getCurrentUser();
          
          // 允许切换到后台模式
          modeBtns.forEach(btn => {
            if (btn.dataset.mode === 'backend') {
              btn.removeAttribute('disabled');
              btn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
          });
        } else {
          loginTrigger.classList.remove('hidden');
          logoutBtn.classList.add('hidden');
          userInfo.classList.add('hidden');
          
          // 切换到前台模式并禁用后台模式切换
          document.getElementById('frontendContent').classList.remove('hidden');
          backendContent.classList.add('hidden');
          modeBtns.forEach(btn => {
            if (btn.dataset.mode === 'backend') {
              btn.setAttribute('disabled', 'true');
              btn.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
              btn.classList.add('active', 'bg-primary', 'text-white');
              btn.classList.remove('bg-gray-100', 'text-gray-700');
              btn.setAttribute('aria-pressed', 'true');
            }
          });
        }
      }
    };

    // 事件处理模块
    const eventHandler = {
      // 初始化所有事件监听
      init() {
        this.initLoginEvents();
        this.initModeSwitchEvents();
        this.initTabSwitchEvents();
        this.initCategoryEvents();
        this.initSubcategoryEvents();
        this.initProductEvents();
        this.initSearchEvents();
        this.initViewSwitchEvents();
        this.initChangePasswordEvents();
      },
      
      // 初始化修改密码相关事件
      initChangePasswordEvents() {
        const changePasswordModal = document.getElementById('changePasswordModal');
        const changePasswordBtn = document.getElementById('changePasswordBtn');
        const cancelChangePasswordBtn = document.getElementById('cancelChangePasswordBtn');
        const changePasswordForm = document.getElementById('changePasswordForm');
        const currentPasswordInput = document.getElementById('currentPassword');
        const newPasswordInput = document.getElementById('newPassword');
        const confirmPasswordInput = document.getElementById('confirmPassword');
        const currentPasswordError = document.querySelector('.current-password-error');
        const newPasswordError = document.querySelector('.new-password-error');
        const confirmPasswordError = document.querySelector('.confirm-password-error');
        const changePasswordError = document.getElementById('changePasswordError');
        
        // 打开修改密码模态框
        changePasswordBtn.addEventListener('click', () => {
          changePasswordModal.classList.remove('hidden');
          currentPasswordInput.focus();
          // 支持ESC关闭
          document.addEventListener('keydown', handleEscClose);
        });
        
        // 关闭修改密码模态框
        cancelChangePasswordBtn.addEventListener('click', () => {
          closeChangePasswordModal();
        });
        
        // 点击模态框外部关闭
        changePasswordModal.addEventListener('click', (e) => {
          if (e.target === changePasswordModal) {
            closeChangePasswordModal();
          }
        });
        
        // 修改密码表单提交
        changePasswordForm.addEventListener('submit', (e) => {
          e.preventDefault();
          let isValid = true;
          
          // 验证当前密码
          if (!utils.validateRequired(currentPasswordInput, currentPasswordError)) isValid = false;
          
          // 验证新密码（至少6位）
          if (!newPasswordInput.value.trim() || newPasswordInput.value.length < 6) {
            newPasswordError.classList.remove('hidden');
            isValid = false;
          } else {
            newPasswordError.classList.add('hidden');
          }
          
          // 验证确认密码
          if (newPasswordInput.value !== confirmPasswordInput.value) {
            confirmPasswordError.classList.remove('hidden');
            isValid = false;
          } else {
            confirmPasswordError.classList.add('hidden');
          }
          
          if (!isValid) return;
          
          const currentPassword = currentPasswordInput.value.trim();
          const newPassword = newPasswordInput.value.trim();
          
          utils.showLoading();
          
          // 模拟请求延迟
          setTimeout(() => {
            const result = dataManager.changePassword(currentPassword, newPassword);
            
            if (result.success) {
              closeChangePasswordModal();
              utils.showNotification('密码修改成功');
            } else {
              changePasswordError.textContent = result.message;
              changePasswordError.classList.remove('hidden');
            }
            
            utils.hideLoading();
          }, 500);
        });
        
        // 输入验证
        currentPasswordInput.addEventListener('blur', () => {
          utils.validateRequired(currentPasswordInput, currentPasswordError);
        });
        
        newPasswordInput.addEventListener('blur', () => {
          if (!newPasswordInput.value.trim() || newPasswordInput.value.length < 6) {
            newPasswordError.classList.remove('hidden');
          } else {
            newPasswordError.classList.add('hidden');
          }
        });
        
        confirmPasswordInput.addEventListener('blur', () => {
          if (newPasswordInput.value !== confirmPasswordInput.value) {
            confirmPasswordError.classList.remove('hidden');
          } else {
            confirmPasswordError.classList.add('hidden');
          }
        });
        
        // 关闭修改密码模态框的辅助函数
        function closeChangePasswordModal() {
          changePasswordModal.classList.add('hidden');
          currentPasswordInput.value = '';
          newPasswordInput.value = '';
          confirmPasswordInput.value = '';
          currentPasswordError.classList.add('hidden');
          newPasswordError.classList.add('hidden');
          confirmPasswordError.classList.add('hidden');
          changePasswordError.classList.add('hidden');
          document.removeEventListener('keydown', handleEscClose);
        }
        
        // ESC关闭处理
        function handleEscClose(e) {
          if (e.key === 'Escape') {
            closeChangePasswordModal();
          }
        }
      },
      
      // 初始化登录相关事件
      initLoginEvents() {
        const loginModal = document.getElementById('loginModal');
        const loginTrigger = document.getElementById('loginTrigger');
        const loginBtn = document.getElementById('loginBtn');
        const cancelLoginBtn = document.getElementById('cancelLoginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const loginError = document.getElementById('loginError');
        const usernameError = document.querySelector('.username-error');
        const passwordError = document.querySelector('.password-error');
        
        // 打开登录模态框
        loginTrigger.addEventListener('click', () => {
          loginModal.classList.remove('hidden');
          usernameInput.focus();
          // 支持ESC关闭
          document.addEventListener('keydown', handleEscClose);
        });
        
        // 关闭登录模态框
        cancelLoginBtn.addEventListener('click', () => {
          closeLoginModal();
        });
        
        // 点击模态框外部关闭
        loginModal.addEventListener('click', (e) => {
          if (e.target === loginModal) {
            closeLoginModal();
          }
        });
        
        // 登录处理
        loginBtn.addEventListener('click', () => {
          let isValid = true;
          
          // 验证输入
          if (!utils.validateRequired(usernameInput, usernameError)) isValid = false;
          if (!utils.validateRequired(passwordInput, passwordError)) isValid = false;
          
          if (!isValid) return;
          
          const username = usernameInput.value.trim();
          const password = passwordInput.value.trim();
          
          utils.showLoading();
          
          // 模拟登录请求延迟
          setTimeout(() => {
            if (dataManager.validateUser(username, password)) {
              dataManager.loginUser(username);
              viewRenderer.updateLoginStatus();
              closeLoginModal();
              utils.showNotification('登录成功');
            } else {
              loginError.textContent = '用户名或密码错误';
              loginError.classList.remove('hidden');
            }
            utils.hideLoading();
          }, 500);
        });
        
        // 登出处理
        logoutBtn.addEventListener('click', () => {
          if (confirm('确定要退出登录吗？')) {
            dataManager.logoutUser();
            viewRenderer.updateLoginStatus();
            utils.showNotification('已退出登录');
          }
        });
        
        // 输入验证
        usernameInput.addEventListener('blur', () => {
          utils.validateRequired(usernameInput, usernameError);
        });
        
        passwordInput.addEventListener('blur', () => {
          utils.validateRequired(passwordInput, passwordError);
        });
        
        // 关闭登录模态框的辅助函数
        function closeLoginModal() {
          loginModal.classList.add('hidden');
          usernameInput.value = '';
          passwordInput.value = '';
          loginError.classList.add('hidden');
          usernameError.classList.add('hidden');
          passwordError.classList.add('hidden');
          document.removeEventListener('keydown', handleEscClose);
        }
        
        // ESC关闭处理
        function handleEscClose(e) {
          if (e.key === 'Escape') {
            closeLoginModal();
          }
        }
      },
      
      // 初始化模式切换事件
      initModeSwitchEvents() {
        const modeBtns = document.querySelectorAll('.mode-btn');
        const frontendContent = document.getElementById('frontendContent');
        const backendContent = document.getElementById('backendContent');
        
        modeBtns.forEach(btn => {
          btn.addEventListener('click', () => {
            // 检查是否登录（后台模式需要登录）
            if (btn.dataset.mode === 'backend' && !dataManager.isLoggedIn()) {
              utils.showNotification('请先登录', 'warning');
              document.getElementById('loginTrigger').click();
              return;
            }
            
            // 更新按钮状态
            modeBtns.forEach(b => {
              b.classList.remove('active', 'bg-primary', 'text-white');
              b.classList.add('bg-gray-100', 'text-gray-700');
              b.setAttribute('aria-pressed', 'false');
            });
            
            btn.classList.add('active', 'bg-primary', 'text-white');
            btn.classList.remove('bg-gray-100', 'text-gray-700');
            btn.setAttribute('aria-pressed', 'true');
            
            // 显示对应内容
            if (btn.dataset.mode === 'frontend') {
              frontendContent.classList.remove('hidden');
              backendContent.classList.add('hidden');
            } else {
              frontendContent.classList.add('hidden');
              backendContent.classList.remove('hidden');
              // 刷新后台数据
              viewRenderer.renderCategories();
              viewRenderer.renderSubcategories();
              viewRenderer.renderProducts();
              viewRenderer.renderCategoryOptions('parentCategory');
              viewRenderer.renderSubcategoryOptions('parentSubcategory');
            }
          });
        });
      },
      
      // 初始化标签页切换事件
      initTabSwitchEvents() {
        const tabBtns = document.querySelectorAll('.manage-tab');
        
        tabBtns.forEach(btn => {
          btn.addEventListener('click', () => {
            const tabId = btn.dataset.tab;
            
            // 更新按钮状态
            tabBtns.forEach(b => {
              b.classList.remove('active', 'text-primary', 'border-b-2', 'border-primary');
              b.classList.add('text-gray-600');
              b.setAttribute('aria-selected', 'false');
            });
            
            btn.classList.add('active', 'text-primary', 'border-b-2', 'border-primary');
            btn.classList.remove('text-gray-600');
            btn.setAttribute('aria-selected', 'true');
            
            // 显示对应标签页
            document.querySelectorAll('[id$="Tab"]').forEach(tab => {
              tab.classList.add('hidden');
            });
            
            document.getElementById(`${tabId}Tab`).classList.remove('hidden');
          });
        });
      },
      
      // 初始化大类相关事件
      initCategoryEvents() {
        const categoryModal = document.getElementById('categoryModal');
        const addCategoryBtn = document.getElementById('addCategoryBtn');
        const cancelCategoryBtn = document.getElementById('cancelCategoryBtn');
        const categoryForm = document.getElementById('categoryForm');
        const categoryIdInput = document.getElementById('categoryId');
        const categoryNameInput = document.getElementById('categoryName');
        const categoryDescInput = document.getElementById('categoryDesc');
        const categoryImageInput = document.getElementById('categoryImage');
        const categoryImagePreview = document.getElementById('categoryImagePreview');
        const categoryImageDataInput = document.getElementById('categoryImageData');
        const categoryNameError = document.querySelector('.category-name-error');
        let currentEditId = null;
        
        // 打开添加大类模态框
        addCategoryBtn.addEventListener('click', () => {
          openCategoryModal();
        });
        
        // 关闭大类模态框
        cancelCategoryBtn.addEventListener('click', () => {
          closeCategoryModal();
        });
        
        // 点击模态框外部关闭
        categoryModal.addEventListener('click', (e) => {
          if (e.target === categoryModal) {
            closeCategoryModal();
          }
        });
        
        // 图片预览
        categoryImageInput.addEventListener('change', (e) => {
          if (e.target.files && e.target.files[0]) {
            const reader = new FileReader();
            
            reader.onload = (event) => {
              categoryImagePreview.src = event.target.result;
              categoryImagePreview.classList.remove('hidden');
              categoryImageDataInput.value = event.target.result;
            };
            
            reader.readAsDataURL(e.target.files[0]);
          }
        });
        
        // 提交大类表单
        categoryForm.addEventListener('submit', (e) => {
          e.preventDefault();
          
          let isValid = true;
          
          // 验证输入
          if (!utils.validateRequired(categoryNameInput, categoryNameError)) isValid = false;
          
          if (!isValid) return;
          
          const categories = dataManager.getCategories();
          const categoryData = {
            name: categoryNameInput.value.trim(),
            desc: categoryDescInput.value.trim(),
            image: categoryImageDataInput.value
          };
          
          utils.showLoading();
          
          // 模拟请求延迟
          setTimeout(() => {
            if (currentEditId) {
              // 编辑现有大类
              const index = categories.findIndex(c => c.id === currentEditId);
              if (index !== -1) {
                categories[index] = { ...categories[index], ...categoryData };
                dataManager.saveCategories(categories);
                utils.showNotification('大类更新成功');
              }
            } else {
              // 添加新大类
              categories.push({
                id: utils.generateId(),
                ...categoryData,
                createdAt: new Date().toISOString()
              });
              dataManager.saveCategories(categories);
              utils.showNotification('大类添加成功');
            }
            
            // 刷新列表
            viewRenderer.renderCategories();
            viewRenderer.renderCategoryOptions('parentCategory');
            closeCategoryModal();
            utils.hideLoading();
          }, 500);
        });
        
        // 编辑大类事件委托
        document.getElementById('categoriesTableBody').addEventListener('click', (e) => {
          if (e.target.closest('.edit-category')) {
            const id = e.target.closest('.edit-category').dataset.id;
            const categories = dataManager.getCategories();
            const category = categories.find(c => c.id === id);
            
            if (category) {
              currentEditId = id;
              categoryIdInput.value = category.id;
              categoryNameInput.value = category.name;
              categoryDescInput.value = category.desc || '';
              categoryImageDataInput.value = category.image || '';
              
              if (category.image) {
                categoryImagePreview.src = category.image;
                categoryImagePreview.classList.remove('hidden');
              } else {
                categoryImagePreview.classList.add('hidden');
              }
              
              document.getElementById('categoryModalTitle').textContent = '编辑大类';
              categoryModal.classList.remove('hidden');
              categoryNameInput.focus();
            }
          } else if (e.target.closest('.delete-category')) {
            const id = e.target.closest('.delete-category').dataset.id;
            const categories = dataManager.getCategories();
            const category = categories.find(c => c.id === id);
            
            if (category && confirm(`确定要删除大类"${category.name}"吗？这将同时删除相关的小类和产品。`)) {
              utils.showLoading();
              
              // 模拟请求延迟
              setTimeout(() => {
                // 删除大类
                const updatedCategories = categories.filter(c => c.id !== id);
                dataManager.saveCategories(updatedCategories);
                
                // 删除相关小类
                const subcategories = dataManager.getSubcategories();
                const updatedSubcategories = subcategories.filter(s => s.parentId !== id);
                dataManager.saveSubcategories(updatedSubcategories);
                
                // 删除相关产品
                const products = dataManager.getProducts();
                const subIds = subcategories
                  .filter(s => s.parentId === id)
                  .map(s => s.id);
                const updatedProducts = products.filter(p => !subIds.includes(p.parentId));
                dataManager.saveProducts(updatedProducts);
                
                // 刷新列表
                viewRenderer.renderCategories();
                viewRenderer.renderSubcategories();
                viewRenderer.renderProducts();
                viewRenderer.renderCategoryOptions('parentCategory');
                viewRenderer.renderSubcategoryOptions('parentSubcategory');
                
                utils.showNotification('大类删除成功');
                utils.hideLoading();
              }, 500);
            }
          }
        });
        
        // 查看大类产品事件委托
        document.getElementById('categoriesGrid').addEventListener('click', (e) => {
          if (e.target.closest('.view-category-products')) {
            const categoryId = e.target.closest('.view-category-products').dataset.id;
            document.getElementById('categoryFilter').value = categoryId;
            // 触发搜索
            document.getElementById('searchBtn').click();
            // 滚动到产品列表
            document.getElementById('productsGrid').scrollIntoView({ behavior: 'smooth' });
          }
        });
        
        // 打开大类模态框的辅助函数
        function openCategoryModal() {
          currentEditId = null;
          categoryIdInput.value = '';
          categoryNameInput.value = '';
          categoryDescInput.value = '';
          categoryImageInput.value = '';
          categoryImageDataInput.value = '';
          categoryImagePreview.src = '';
          categoryImagePreview.classList.add('hidden');
          categoryNameError.classList.add('hidden');
          
          document.getElementById('categoryModalTitle').textContent = '添加大类';
          categoryModal.classList.remove('hidden');
          categoryNameInput.focus();
        }
        
        // 关闭大类模态框的辅助函数
        function closeCategoryModal() {
          categoryModal.classList.add('hidden');
        }
      },
      
      // 初始化小类相关事件
      initSubcategoryEvents() {
        const subcategoryModal = document.getElementById('subcategoryModal');
        const addSubcategoryBtn = document.getElementById('addSubcategoryBtn');
        const cancelSubcategoryBtn = document.getElementById('cancelSubcategoryBtn');
        const subcategoryForm = document.getElementById('subcategoryForm');
        const subcategoryIdInput = document.getElementById('subcategoryId');
        const parentCategorySelect = document.getElementById('parentCategory');
        const subcategoryNameInput = document.getElementById('subcategoryName');
        const subcategoryDescInput = document.getElementById('subcategoryDesc');
        const parentCategoryError = document.querySelector('.parent-category-error');
        const subcategoryNameError = document.querySelector('.subcategory-name-error');
        let currentEditId = null;
        
        // 打开添加小类模态框
        addSubcategoryBtn.addEventListener('click', () => {
          const categories = dataManager.getCategories();
          if (categories.length === 0) {
            utils.showNotification('请先添加产品大类', 'warning');
            return;
          }
          
          openSubcategoryModal();
        });
        
        // 关闭小类模态框
        cancelSubcategoryBtn.addEventListener('click', () => {
          closeSubcategoryModal();
        });
        
        // 点击模态框外部关闭
        subcategoryModal.addEventListener('click', (e) => {
          if (e.target === subcategoryModal) {
            closeSubcategoryModal();
          }
        });
        
        // 提交小类表单
        subcategoryForm.addEventListener('submit', (e) => {
          e.preventDefault();
          
          let isValid = true;
          
          // 验证输入
          if (!utils.validateRequired(parentCategorySelect, parentCategoryError)) isValid = false;
          if (!utils.validateRequired(subcategoryNameInput, subcategoryNameError)) isValid = false;
          
          if (!isValid) return;
          
          const subcategories = dataManager.getSubcategories();
          const subcategoryData = {
            parentId: parentCategorySelect.value,
            name: subcategoryNameInput.value.trim(),
            desc: subcategoryDescInput.value.trim()
          };
          
          utils.showLoading();
          
          // 模拟请求延迟
          setTimeout(() => {
            if (currentEditId) {
              // 编辑现有小类
              const index = subcategories.findIndex(s => s.id === currentEditId);
              if (index !== -1) {
                subcategories[index] = { ...subcategories[index], ...subcategoryData };
                dataManager.saveSubcategories(subcategories);
                utils.showNotification('小类更新成功');
              }
            } else {
              // 添加新小类
              subcategories.push({
                id: utils.generateId(),
                ...subcategoryData,
                createdAt: new Date().toISOString()
              });
              dataManager.saveSubcategories(subcategories);
              utils.showNotification('小类添加成功');
            }
            
            // 刷新列表
            viewRenderer.renderSubcategories();
            viewRenderer.renderSubcategoryOptions('parentSubcategory');
            closeSubcategoryModal();
            utils.hideLoading();
          }, 500);
        });
        
        // 编辑小类事件委托
        document.getElementById('subcategoriesTableBody').addEventListener('click', (e) => {
          if (e.target.closest('.edit-subcategory')) {
            const id = e.target.closest('.edit-subcategory').dataset.id;
            const subcategories = dataManager.getSubcategories();
            const subcategory = subcategories.find(s => s.id === id);
            
            if (subcategory) {
              currentEditId = id;
              subcategoryIdInput.value = subcategory.id;
              parentCategorySelect.value = subcategory.parentId;
              subcategoryNameInput.value = subcategory.name;
              subcategoryDescInput.value = subcategory.desc || '';
              
              document.getElementById('subcategoryModalTitle').textContent = '编辑小类';
              subcategoryModal.classList.remove('hidden');
              subcategoryNameInput.focus();
            }
          } else if (e.target.closest('.delete-subcategory')) {
            const id = e.target.closest('.delete-subcategory').dataset.id;
            const subcategories = dataManager.getSubcategories();
            const subcategory = subcategories.find(s => s.id === id);
            
            if (subcategory) {
              // 检查是否有关联产品
              const products = dataManager.getProducts();
              const hasProducts = products.some(p => p.parentId === id);
              
              const confirmMessage = hasProducts 
                ? `确定要删除小类"${subcategory.name}"吗？这将同时删除该小类下的所有产品。`
                : `确定要删除小类"${subcategory.name}"吗？`;
              
              if (confirm(confirmMessage)) {
                utils.showLoading();
                
                // 模拟请求延迟
                setTimeout(() => {
                  // 删除小类
                  const updatedSubcategories = subcategories.filter(s => s.id !== id);
                  dataManager.saveSubcategories(updatedSubcategories);
                  
                  // 删除相关产品
                  if (hasProducts) {
                    const updatedProducts = products.filter(p => p.parentId !== id);
                    dataManager.saveProducts(updatedProducts);
                  }
                  
                  // 刷新列表
                  viewRenderer.renderSubcategories();
                  viewRenderer.renderProducts();
                  viewRenderer.renderSubcategoryOptions('parentSubcategory');
                  
                  utils.showNotification('小类删除成功');
                  utils.hideLoading();
                }, 500);
              }
            }
          }
        });
        
        // 打开小类模态框的辅助函数
        function openSubcategoryModal() {
          currentEditId = null;
          subcategoryIdInput.value = '';
          subcategoryNameInput.value = '';
          subcategoryDescInput.value = '';
          parentCategoryError.classList.add('hidden');
          subcategoryNameError.classList.add('hidden');
          
          // 刷新大类选项
          viewRenderer.renderCategoryOptions('parentCategory');
          
          document.getElementById('subcategoryModalTitle').textContent = '添加小类';
          subcategoryModal.classList.remove('hidden');
          subcategoryNameInput.focus();
        }
        
        // 关闭小类模态框的辅助函数
        function closeSubcategoryModal() {
          subcategoryModal.classList.add('hidden');
        }
      },
      
      // 初始化产品相关事件
      initProductEvents() {
        const productModal = document.getElementById('productModal');
        const addProductBtn = document.getElementById('addProductBtn');
        const cancelProductBtn = document.getElementById('cancelProductBtn');
        const productForm = document.getElementById('productForm');
        const productIdInput = document.getElementById('productId');
        const parentSubcategorySelect = document.getElementById('parentSubcategory');
        const productNameInput = document.getElementById('productName');
        const productPriceInput = document.getElementById('productPrice');
        const productAttributes = document.getElementById('productAttributes');
        const addAttributeBtn = document.getElementById('addAttributeBtn');
        const productAttrsInput = document.getElementById('productAttrs');
        const productImagesInput = document.getElementById('productImages');
        const productImagesPreview = document.getElementById('productImagesPreview');
        const productImagesDataInput = document.getElementById('productImagesData');
        const productNameError = document.querySelector('.product-name-error');
        const parentSubcategoryError = document.querySelector('.parent-subcategory-error');
        const productPriceError = document.querySelector('.product-price-error');
        let currentEditId = null;
        let currentImages = [];
        
        // 初始化属性相关事件
        initAttributeEvents();
        
        // 初始化属性相关事件
        function initAttributeEvents() {
          // 添加属性按钮事件
          addAttributeBtn.addEventListener('click', addAttributeItem);
          
          // 为属性项添加变化监听，实时更新隐藏的属性输入
          productAttributes.addEventListener('change', updateProductAttrsInput);
          productAttributes.addEventListener('input', updateProductAttrsInput);
          
          // 为已有的属性项绑定事件
          document.querySelectorAll('.attribute-item').forEach(item => {
            bindAttributeItemEvents(item);
          });
        }
        
        // 为属性项绑定事件
        function bindAttributeItemEvents(item) {
          // 类型选择事件
          const typeSelect = item.querySelector('.attribute-type');
          const nameInput = item.querySelector('.attribute-name');
          
          typeSelect.addEventListener('change', () => {
            if (typeSelect.value === 'custom') {
              nameInput.classList.remove('hidden');
            } else {
              nameInput.classList.add('hidden');
            }
          });
          
          // 删除属性按钮事件
          const deleteBtn = item.querySelector('.delete-attribute');
          deleteBtn.addEventListener('click', () => {
            item.remove();
            updateProductAttrsInput();
          });
        }
        
        // 添加新的属性项
        function addAttributeItem() {
          const newItem = document.createElement('div');
          newItem.className = 'attribute-item flex gap-2 items-center';
          newItem.innerHTML = `
            <select class="attribute-type px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-smooth">
              <option value="size">尺寸</option>
              <option value="color">颜色</option>
              <option value="power">功率</option>
              <option value="custom">自定义</option>
            </select>
            <input type="text" class="attribute-name hidden px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-smooth" placeholder="属性名称">
            <input type="text" class="attribute-value flex-grow px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-smooth" placeholder="属性值">
            <button type="button" class="delete-attribute px-3 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-smooth" aria-label="删除属性">
              <i class="fa fa-times"></i>
            </button>
          `;
          
          productAttributes.appendChild(newItem);
          bindAttributeItemEvents(newItem);
        }
        
        // 加载产品属性数据
        function loadProductAttributes(attributes) {
          // 清空现有属性项
          productAttributes.innerHTML = '';
          
          if (attributes && attributes.length > 0) {
            // 添加每个属性项
            attributes.forEach(attr => {
              const newItem = document.createElement('div');
              newItem.className = 'attribute-item flex gap-2 items-center';
              
              const isCustom = attr.type === 'custom';
              
              newItem.innerHTML = `
                <select class="attribute-type px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-smooth">
                  <option value="size" ${attr.type === 'size' ? 'selected' : ''}>尺寸</option>
                  <option value="color" ${attr.type === 'color' ? 'selected' : ''}>颜色</option>
                  <option value="power" ${attr.type === 'power' ? 'selected' : ''}>功率</option>
                  <option value="custom" ${isCustom ? 'selected' : ''}>自定义</option>
                </select>
                <input type="text" class="attribute-name ${isCustom ? '' : 'hidden'} px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-smooth" placeholder="属性名称" value="${isCustom ? attr.name : ''}">
                <input type="text" class="attribute-value flex-grow px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-smooth" placeholder="属性值" value="${attr.value}">
                <button type="button" class="delete-attribute px-3 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-smooth" aria-label="删除属性">
                  <i class="fa fa-times"></i>
                </button>
              `;
              
              productAttributes.appendChild(newItem);
              bindAttributeItemEvents(newItem);
            });
          } else {
            // 如果没有属性，添加两个默认属性项
            for (let i = 0; i < 2; i++) {
              addAttributeItem();
            }
          }
          
          updateProductAttrsInput();
        }
        
        // 更新隐藏的属性输入
        function updateProductAttrsInput() {
          const attributes = [];
          document.querySelectorAll('.attribute-item').forEach(item => {
            const type = item.querySelector('.attribute-type').value;
            const name = type === 'custom' 
              ? item.querySelector('.attribute-name').value.trim() 
              : getAttributeTypeName(type);
            const value = item.querySelector('.attribute-value').value.trim();
            
            if (name && value) {
              attributes.push({ type, name, value });
            }
          });
          
          productAttrsInput.value = JSON.stringify(attributes);
        }
        
        // 根据属性类型获取显示名称
        function getAttributeTypeName(type) {
          switch (type) {
            case 'size': return '尺寸';
            case 'color': return '颜色';
            case 'power': return '功率';
            default: return '属性';
          }
        }
        addProductBtn.addEventListener('click', () => {
          const subcategories = dataManager.getSubcategories();
          if (subcategories.length === 0) {
            utils.showNotification('请先添加产品小类', 'warning');
            return;
          }
          
          openProductModal();
        });
        
        // 关闭产品模态框
        cancelProductBtn.addEventListener('click', () => {
          closeProductModal();
        });
        
        // 点击模态框外部关闭
        productModal.addEventListener('click', (e) => {
          if (e.target === productModal) {
            closeProductModal();
          }
        });
        
        // 产品图片预览
        productImagesInput.addEventListener('change', (e) => {
          if (e.target.files && e.target.files.length > 0) {
            const files = Array.from(e.target.files);
            
            files.forEach(file => {
              const reader = new FileReader();
              
              reader.onload = (event) => {
                currentImages.push(event.target.result);
                updateProductImagesPreview();
                productImagesDataInput.value = JSON.stringify(currentImages);
              };
              
              reader.readAsDataURL(file);
            });
          }
        });
        
        // 提交产品表单
        productForm.addEventListener('submit', (e) => {
          e.preventDefault();
          
          let isValid = true;
          
          // 验证输入
          if (!utils.validateRequired(productNameInput, productNameError)) isValid = false;
          if (!utils.validateRequired(parentSubcategorySelect, parentSubcategoryError)) isValid = false;
          
          // 价格验证
          if (!productPriceInput.value || isNaN(productPriceInput.value) || parseFloat(productPriceInput.value) < 0) {
            productPriceError.textContent = '请输入有效的价格';
            productPriceError.classList.remove('hidden');
            isValid = false;
          } else {
            productPriceError.classList.add('hidden');
            }
            
            if (!isValid) return;
            
            const products = dataManager.getProducts();
            
            // 收集属性数据
            const attributes = [];
            document.querySelectorAll('.attribute-item').forEach(item => {
              const type = item.querySelector('.attribute-type').value;
              const name = type === 'custom' 
                ? item.querySelector('.attribute-name').value.trim() 
                : getAttributeTypeName(type);
              const value = item.querySelector('.attribute-value').value.trim();
              
              if (name && value) {
                attributes.push({ type, name, value });
              }
            });
            
            const productData = {
              parentId: parentSubcategorySelect.value,
              name: productNameInput.value.trim(),
              price: productPriceInput.value.trim(),
              attrs: attributes,
              images: currentImages
            };
          
          utils.showLoading();
          
          // 模拟请求延迟
          setTimeout(() => {
            if (currentEditId) {
              // 编辑现有产品
              const index = products.findIndex(p => p.id === currentEditId);
              if (index !== -1) {
                products[index] = { ...products[index], ...productData };
                dataManager.saveProducts(products);
                utils.showNotification('产品更新成功');
              }
            } else {
              // 添加新产品
              products.push({
                id: utils.generateId(),
                ...productData,
                createdAt: new Date().toISOString()
              });
              dataManager.saveProducts(products);
              utils.showNotification('产品添加成功');
            }
            
            // 刷新列表
            viewRenderer.renderProducts();
            closeProductModal();
            utils.hideLoading();
          }, 500);
        });
        
        // 编辑产品事件委托
        document.getElementById('productsTableBody').addEventListener('click', (e) => {
          if (e.target.closest('.edit-product')) {
            const id = e.target.closest('.edit-product').dataset.id;
            const products = dataManager.getProducts();
            const product = products.find(p => p.id === id);
            
            if (product) {
              currentEditId = id;
              currentImages = product.images || [];
              
              productIdInput.value = product.id;
              parentSubcategorySelect.value = product.parentId;
              productNameInput.value = product.name;
              productPriceInput.value = product.price;
              productImagesDataInput.value = JSON.stringify(currentImages);
              
              // 加载属性数据
              loadProductAttributes(product.attrs || []);
              
              updateProductImagesPreview();
              
              document.getElementById('productModalTitle').textContent = '编辑产品';
              productModal.classList.remove('hidden');
              productNameInput.focus();
            }
          } else if (e.target.closest('.delete-product')) {
            const id = e.target.closest('.delete-product').dataset.id;
            const products = dataManager.getProducts();
            const product = products.find(p => p.id === id);
            
            if (product && confirm(`确定要删除产品"${product.name}"吗？`)) {
              utils.showLoading();
              
              // 模拟请求延迟
              setTimeout(() => {
                // 删除产品
                const updatedProducts = products.filter(p => p.id !== id);
                dataManager.saveProducts(updatedProducts);
                
                // 刷新列表
                viewRenderer.renderProducts();
                
                utils.showNotification('产品删除成功');
                utils.hideLoading();
              }, 500);
            }
          }
        });
        
        // 更新产品图片预览
        function updateProductImagesPreview() {
          productImagesPreview.innerHTML = '';
          
          currentImages.forEach((image, index) => {
            const previewContainer = document.createElement('div');
            previewContainer.className = 'relative group';
            previewContainer.innerHTML = `
              <img src="${image}" alt="产品图片" class="w-full h-20 object-cover rounded-lg">
              <button type="button" class="delete-image absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-smooth" data-index="${index}">
                <i class="fa fa-times text-xs"></i>
              </button>
            `;
            productImagesPreview.appendChild(previewContainer);
          });
          
          // 添加删除图片事件
          document.querySelectorAll('.delete-image').forEach(btn => {
            btn.addEventListener('click', (e) => {
              const index = parseInt(e.target.closest('.delete-image').dataset.index);
              currentImages.splice(index, 1);
              productImagesDataInput.value = JSON.stringify(currentImages);
              updateProductImagesPreview();
            });
          });
        }
        
        // 打开产品模态框的辅助函数
        function openProductModal() {
          currentEditId = null;
          currentImages = [];
          productIdInput.value = '';
          productNameInput.value = '';
          productPriceInput.value = '';
          productImagesInput.value = '';
          productImagesDataInput.value = '';
          productImagesPreview.innerHTML = '';
          productNameError.classList.add('hidden');
          parentSubcategoryError.classList.add('hidden');
          productPriceError.classList.add('hidden');
          
          // 初始化属性输入区域
          loadProductAttributes([]);
          
          // 刷新小类选项
          viewRenderer.renderSubcategoryOptions('parentSubcategory');
          
          document.getElementById('productModalTitle').textContent = '添加产品';
          productModal.classList.remove('hidden');
          productNameInput.focus();
        }
        
        // 关闭产品模态框的辅助函数
        function closeProductModal() {
          productModal.classList.add('hidden');
        }
      },
      
      // 初始化搜索相关事件
      initSearchEvents() {
        const searchInput = document.getElementById('searchInput');
        const categoryFilter = document.getElementById('categoryFilter');
        const searchBtn = document.getElementById('searchBtn');
        
        // 搜索按钮点击
        searchBtn.addEventListener('click', performSearch);
        
        // 输入框回车搜索
        searchInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            performSearch();
          }
        });
        
        // 筛选下拉框变化
        categoryFilter.addEventListener('change', performSearch);
        
        // 防抖处理的搜索输入
        searchInput.addEventListener('input', utils.debounce(performSearch));
        
        // 执行搜索
        function performSearch() {
          const filter = {
            categoryId: categoryFilter.value !== 'all' ? categoryFilter.value : '',
            search: searchInput.value.trim()
          };
          
          viewRenderer.renderProducts(filter);
        }
      },
      
      // 初始化视图切换事件
      initViewSwitchEvents() {
        const gridViewBtn = document.getElementById('gridViewBtn');
        const listViewBtn = document.getElementById('listViewBtn');
        const productsGrid = document.getElementById('productsGrid');
        
        // 网格视图
        gridViewBtn.addEventListener('click', () => {
          gridViewBtn.classList.add('bg-primary/10', 'text-primary', 'active');
          gridViewBtn.classList.remove('hover:bg-gray-100', 'text-gray-700');
          gridViewBtn.setAttribute('aria-pressed', 'true');
          
          listViewBtn.classList.remove('bg-primary/10', 'text-primary', 'active');
          listViewBtn.classList.add('hover:bg-gray-100', 'text-gray-700');
          listViewBtn.setAttribute('aria-pressed', 'false');
          
          productsGrid.className = 'grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6';
        });
        
        // 列表视图
        listViewBtn.addEventListener('click', () => {
          listViewBtn.classList.add('bg-primary/10', 'text-primary', 'active');
          listViewBtn.classList.remove('hover:bg-gray-100', 'text-gray-700');
          listViewBtn.setAttribute('aria-pressed', 'true');
          
          gridViewBtn.classList.remove('bg-primary/10', 'text-primary', 'active');
          gridViewBtn.classList.add('hover:bg-gray-100', 'text-gray-700');
          gridViewBtn.setAttribute('aria-pressed', 'false');
          
          productsGrid.className = 'grid grid-cols-1 gap-4';
        });
      }
    };

    // 初始化图片点击事件
    function initImageClickEvents() {
      const productsGrid = document.getElementById('productsGrid');
      
      // 使用事件委托来处理图片点击
      productsGrid.addEventListener('click', function(e) {
        const img = e.target.closest('img[loading="lazy"]');
        if (img) {
          // 获取产品卡片
          const card = img.closest('.bg-white.rounded-xl.overflow-hidden.card-shadow');
          if (card) {
            // 从数据中查找对应的产品
            const products = dataManager.getProducts();
            const productName = card.querySelector('h3.font-bold').textContent;
            const product = products.find(p => p.name === productName);
            
            if (product && product.images && product.images.length > 0) {
              openImageViewer(product);
            }
          }
        }
      });
    }

    // 打开图片查看器
    function openImageViewer(product) {
      // 创建图片查看器容器
      const viewer = document.createElement('div');
      viewer.className = 'fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-90 p-4';
      viewer.id = 'imageViewer';
      
      // 构建图片查看器内容
      viewer.innerHTML = `
        <div class="relative w-full max-w-5xl">
          <!-- 关闭按钮 -->
          <button id="closeImageViewer" class="absolute -top-12 right-0 text-white text-2xl hover:text-gray-300 transition-smooth">
            <i class="fa fa-times"></i>
          </button>
          
          <!-- 图片容器 -->
          <div class="relative bg-white bg-opacity-10 p-2 rounded-lg">
            <img id="viewerMainImage" src="${product.images[0]}" alt="${product.name}" class="w-full h-auto max-h-[80vh] object-contain">
            
            <!-- 上一张/下一张按钮 -->
            <button id="prevImageBtn" class="absolute left-2 top-1/2 -translate-y-1/2 w-10 h-10 bg-white bg-opacity-20 text-white rounded-full flex items-center justify-center hover:bg-opacity-30 transition-smooth">
              <i class="fa fa-chevron-left"></i>
            </button>
            <button id="nextImageBtn" class="absolute right-2 top-1/2 -translate-y-1/2 w-10 h-10 bg-white bg-opacity-20 text-white rounded-full flex items-center justify-center hover:bg-opacity-30 transition-smooth">
              <i class="fa fa-chevron-right"></i>
            </button>
            
            <!-- 图片计数器 -->
            <div class="absolute bottom-2 left-1/2 -translate-x-1/2 bg-black bg-opacity-70 text-white px-3 py-1 rounded-full text-sm">
              <span id="currentImageIndex">1</span>/<span id="totalImages">${product.images.length}</span>
            </div>
          </div>
        </div>
      `;
      
      // 添加到文档中
      document.body.appendChild(viewer);
      
      // 添加事件监听
      let currentIndex = 0;
      const mainImage = document.getElementById('viewerMainImage');
      const prevBtn = document.getElementById('prevImageBtn');
      const nextBtn = document.getElementById('nextImageBtn');
      const closeBtn = document.getElementById('closeImageViewer');
      const currentIndexEl = document.getElementById('currentImageIndex');
      
      // 切换图片
      function updateImage(index) {
        if (index >= 0 && index < product.images.length) {
          currentIndex = index;
          mainImage.src = product.images[currentIndex];
          currentIndexEl.textContent = currentIndex + 1;
        }
      }
      
      // 上一张
      prevBtn.addEventListener('click', () => {
        updateImage(currentIndex - 1);
      });
      
      // 下一张
      nextBtn.addEventListener('click', () => {
        updateImage(currentIndex + 1);
      });
      
      // 关闭
      closeBtn.addEventListener('click', () => {
        document.body.removeChild(viewer);
      });
      
      // 点击空白区域关闭
      viewer.addEventListener('click', (e) => {
        if (e.target === viewer) {
          document.body.removeChild(viewer);
        }
      });
      
      // 键盘控制
      function handleKeyDown(e) {
        if (e.key === 'ArrowLeft') {
          updateImage(currentIndex - 1);
        } else if (e.key === 'ArrowRight') {
          updateImage(currentIndex + 1);
        } else if (e.key === 'Escape') {
          document.body.removeChild(viewer);
          document.removeEventListener('keydown', handleKeyDown);
        }
      }
      
      document.addEventListener('keydown', handleKeyDown);
    }

    // 语言资源对象
    const languageResources = {
      zh: {
        systemTitle: '灯具产品展示系统',
        welcome: '欢迎，',
        login: '登录',
        logout: '退出登录',
        frontend: '前台展示',
        backend: '后台管理',
        searchPlaceholder: '搜索产品名称或描述...',
        allCategories: '所有类别',
        search: '搜索',
        productList: '产品列表',
        gridView: '网格视图',
        listView: '列表视图',
        showingItems: '显示',
        totalItems: '条，共',
        noProducts: '没有找到匹配的产品',
        manageCategories: '管理大类',
        manageSubcategories: '管理小类',
        manageProducts: '管理产品',
        addCategory: '添加大类',
        id: 'ID',
        categoryName: '大类名称',
        subcategoryName: '小类名称',
        description: '描述',
        operations: '操作',
        addSubcategory: '添加小类',
        noCategories: '暂无产品大类数据，请添加',
        noSubcategories: '暂无产品小类数据，请添加',
        addProduct: '添加产品',
        productName: '产品名称',
        parentSubcategory: '所属小类',
        price: '价格',
        uploadImages: '上传图片',
        uploadImagesDesc: '上传图片（可上传多张）',
        imageFormat: 'PNG, JPG 或 GIF（最大 10MB）',
        cancel: '取消',
        save: '保存',
        delete: '删除',
        edit: '编辑',
        prevPage: '上一页',
        nextPage: '下一页',
        pageInfo: '第 {page} 页',
        upload: '上传图片',
        dragDrop: '或拖放',
        addAttribute: '添加属性',
        loading: '加载中...',
        loginSuccess: '登录成功',
        logoutSuccess: '退出成功',
        addSuccess: '添加成功',
        updateSuccess: '更新成功',
        deleteSuccess: '删除成功',
        unknownSubcategory: '未知小类',
        noDescription: '暂无属性',
        changePassword: '修改密码',
        currentPassword: '当前密码',
        newPassword: '新密码',
        confirmPassword: '确认新密码',
        passwordChangeSuccess: '密码修改成功',
        currentPasswordError: '当前密码不正确',
        newPasswordMinLength: '请输入新密码（至少6位）',
        confirmPasswordError: '两次输入的密码不一致'
      },
      en: {
        systemTitle: 'Lighting Product Display System',
        welcome: 'Welcome, ',
        login: 'Login',
        logout: 'Logout',
        frontend: 'Frontend',
        backend: 'Backend',
        searchPlaceholder: 'Search product name or description...',
        allCategories: 'All Categories',
        search: 'Search',
        productList: 'Product List',
        gridView: 'Grid View',
        listView: 'List View',
        showingItems: 'Showing',
        totalItems: 'items, total',
        noProducts: 'No matching products found',
        manageCategories: 'Manage Categories',
        manageSubcategories: 'Manage Subcategories',
        manageProducts: 'Manage Products',
        addCategory: 'Add Category',
        id: 'ID',
        categoryName: 'Category Name',
        subcategoryName: 'Subcategory Name',
        description: 'Description',
        operations: 'Operations',
        addSubcategory: 'Add Subcategory',
        noCategories: 'No category data, please add',
        noSubcategories: 'No subcategory data, please add',
        addProduct: 'Add Product',
        productName: 'Product Name',
        parentSubcategory: 'Parent Subcategory',
        price: 'Price',
        uploadImages: 'Upload Images',
        uploadImagesDesc: 'Upload Images (Multiple uploads allowed)',
        imageFormat: 'PNG, JPG or GIF (max 10MB)',
        cancel: 'Cancel',
        save: 'Save',
        delete: 'Delete',
        edit: 'Edit',
        prevPage: 'Previous',
        nextPage: 'Next',
        pageInfo: 'Page {page}',
        upload: 'Upload Images',
        dragDrop: 'or drag and drop',
        addAttribute: 'Add Attribute',
        loading: 'Loading...',
        loginSuccess: 'Login successful',
        logoutSuccess: 'Logout successful',
        addSuccess: 'Add successful',
        updateSuccess: 'Update successful',
        deleteSuccess: 'Delete successful',
        unknownSubcategory: 'Unknown Subcategory',
        noDescription: 'No description',
        changePassword: 'Change Password',
        currentPassword: 'Current Password',
        newPassword: 'New Password',
        confirmPassword: 'Confirm Password',
        passwordChangeSuccess: 'Password changed successfully',
        currentPasswordError: 'Current password is incorrect',
        newPasswordMinLength: 'Please enter new password (at least 6 characters)',
        confirmPasswordError: 'Passwords do not match'
      }
    };

    // 当前语言
    let currentLang = localStorage.getItem('appLanguage') || 'zh';

    // 初始化语言切换功能
    function initLanguageSwitcher() {
      const languageSwitcher = document.getElementById('languageSwitcher');
      const langBtns = languageSwitcher.querySelectorAll('.lang-btn');
      
      // 设置初始语言按钮状态
      langBtns.forEach(btn => {
        if (btn.dataset.lang === currentLang) {
          btn.classList.add('active', 'bg-white', 'text-dark');
          btn.classList.remove('text-gray-600', 'hover:text-dark');
        } else {
          btn.classList.remove('active', 'bg-white', 'text-dark');
          btn.classList.add('text-gray-600', 'hover:text-dark');
        }
      });
      
      // 添加语言切换事件
      langBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          const newLang = btn.dataset.lang;
          if (newLang !== currentLang) {
            currentLang = newLang;
            localStorage.setItem('appLanguage', currentLang);
            updateUIWithLanguage(currentLang);
            
            // 更新按钮状态
            langBtns.forEach(b => {
              if (b.dataset.lang === currentLang) {
                b.classList.add('active', 'bg-white', 'text-dark');
                b.classList.remove('text-gray-600', 'hover:text-dark');
              } else {
                b.classList.remove('active', 'bg-white', 'text-dark');
                b.classList.add('text-gray-600', 'hover:text-dark');
              }
            });
          }
        });
      });
      
      // 初始更新UI
      updateUIWithLanguage(currentLang);
    }

    // 更新UI语言
    function updateUIWithLanguage(lang) {
      const resources = languageResources[lang];
      
      // 更新固定文本元素
      // 使用更简单的选择器查找页面标题
      const titleElement = document.querySelector('header h1');
      if (titleElement) titleElement.textContent = resources.systemTitle;
      document.getElementById('loginTrigger').querySelector('span').textContent = resources.login;
      document.getElementById('logoutBtn').querySelector('span').textContent = resources.logout;
      document.querySelector('.mode-btn[data-mode="frontend"]').textContent = resources.frontend;
      document.querySelector('.mode-btn[data-mode="backend"]').textContent = resources.backend;
      document.getElementById('searchInput').placeholder = resources.searchPlaceholder;
      document.querySelector('#categoryFilter option[value="all"]').textContent = resources.allCategories;
      document.getElementById('searchBtn').querySelector('span').textContent = resources.search;
      document.querySelector('.bg-white.rounded-xl.shadow-md.p-6 h2.text-2xl').textContent = resources.productList;
      document.querySelector('#gridViewBtn').setAttribute('aria-label', resources.gridView);
      document.querySelector('#listViewBtn').setAttribute('aria-label', resources.listView);
      
      // 更新后台管理文本
      document.querySelector('.manage-tab[data-tab="categories"]').textContent = resources.manageCategories;
      document.querySelector('.manage-tab[data-tab="subcategories"]').textContent = resources.manageSubcategories;
      document.querySelector('.manage-tab[data-tab="products"]').textContent = resources.manageProducts;
      
      // 更新按钮文本
      const addCategoryBtn = document.getElementById('addCategoryBtn');
      if (addCategoryBtn) addCategoryBtn.querySelector('span').textContent = resources.addCategory;
      
      // 更新表头
      const tableHeaders = document.querySelectorAll('th.py-3.px-4.text-left.text-sm.font-medium.text-gray-600');
      tableHeaders.forEach(header => {
        if (header.textContent.includes('ID')) header.textContent = resources.id;
        else if (header.textContent.includes('大类名称')) header.textContent = resources.categoryName;
        else if (header.textContent.includes('小类名称')) header.textContent = resources.subcategoryName;
        else if (header.textContent.includes('描述')) header.textContent = resources.description;
        else if (header.textContent.includes('操作')) header.textContent = resources.operations;
      });
      
      // 更新分页控件
      document.getElementById('prevPage').textContent = resources.prevPage;
      document.getElementById('nextPage').textContent = resources.nextPage;
      
      // 更新产品列表中的"暂无属性"
      document.querySelectorAll('p.text-gray-600.text-sm.mb-3.flex-grow').forEach(el => {
        if (el.textContent.includes('暂无属性')) {
          el.textContent = resources.noDescription;
        }
      });
    }

    // 初始化应用
    function initApp() {
      // 初始化数据
      dataManager.init();
      
      // 初始化视图
      viewRenderer.renderCategories();
      viewRenderer.renderSubcategories();
      viewRenderer.renderProducts();
      viewRenderer.updateLoginStatus();
      
      // 初始化事件监听
      eventHandler.init();
      
      // 初始化图片点击事件
      initImageClickEvents();
      
      // 初始化语言切换
      initLanguageSwitcher();
    }

    // 启动应用
    document.addEventListener('DOMContentLoaded', initApp);
  </script>
</body>
</html>
